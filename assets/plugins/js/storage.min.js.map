{"version":3,"file":"storage.min.js","sources":["../../../src/plugins/storage/js/storage.js"],"sourcesContent":["const NAME = 'storage';\r\n\r\nclass Storage {\r\n  // Getters\r\n  static get NAME() {\r\n    return NAME;\r\n  }\r\n\r\n  // Public\r\n\r\n  // Private\r\n\r\n  // Static\r\n  static set(name, value, expires) {\r\n    // check expiry when storage is setting\r\n    this.checkExpiry();\r\n\r\n    localStorage.setItem(name, JSON.stringify(value));\r\n\r\n    if (typeof expires === 'number') {\r\n      const expiryList = this.get('expiryList') || [];\r\n\r\n      // expiry in days\r\n      expires = new Date(Number(new Date()) + expires * 1000 * 60 * 60 * 24);\r\n\r\n      if (this.isPresentOnExpiryList(name)) {\r\n        const index = expiryList.findIndex((el) => el[name] !== undefined);\r\n        expiryList[index][name] = expires;\r\n      } else {\r\n        expiryList.push({ [name]: expires });\r\n      }\r\n\r\n      localStorage.setItem('expiryList', JSON.stringify(expiryList));\r\n    }\r\n\r\n    return `${name}: ${value}, expiries: ${expires}`;\r\n  }\r\n\r\n  static get(name) {\r\n    // check expiry when storage is getting\r\n    this.checkExpiry();\r\n\r\n    return JSON.parse(localStorage.getItem(name));\r\n  }\r\n\r\n  static remove(name) {\r\n    // check expiry when storage is removing\r\n    this.checkExpiry();\r\n\r\n    localStorage.removeItem(name);\r\n\r\n    const expiryList = this.get('expiryList') || [];\r\n\r\n    if (this.isPresentOnExpiryList(name)) {\r\n      const filteredList = expiryList.filter((el) => {\r\n        const elKey = Object.keys(el);\r\n        return elKey[0] !== name;\r\n      });\r\n\r\n      localStorage.setItem('expiryList', JSON.stringify(filteredList));\r\n    }\r\n  }\r\n\r\n  static isPresentOnExpiryList(name) {\r\n    const expiryList = this.get('expiryList') || [];\r\n    return expiryList.some((el) => {\r\n      return el[name] !== undefined;\r\n    });\r\n  }\r\n\r\n  static check(name, time, callback) {\r\n    const expiryList = this.get('expiryList') || [];\r\n\r\n    const filteredList = expiryList.filter((el) => {\r\n      const elKey = Object.keys(el);\r\n      return elKey[0] === name;\r\n    });\r\n\r\n    // time in seconds\r\n    time *= 6000;\r\n\r\n    const intervalId = setInterval(() => {\r\n      if (new Date(filteredList[0][name]) < new Date()) {\r\n        callback();\r\n        clearInterval(intervalId);\r\n      }\r\n\r\n      this.checkExpiry();\r\n    }, time);\r\n  }\r\n\r\n  static checkExpiry() {\r\n    const expiryList = JSON.parse(localStorage.getItem('expiryList')) || [];\r\n    const now = new Date();\r\n\r\n    expiryList.filter((el) => {\r\n      const elKey = Object.keys(el);\r\n\r\n      if (now > new Date(el[elKey])) {\r\n        localStorage.removeItem(elKey[0]);\r\n      }\r\n\r\n      return el[elKey] >= now;\r\n    });\r\n  }\r\n\r\n  static showModalNewUser(id) {\r\n    if (this.get('is-first-visit') === null) {\r\n      const modalElement = document.getElementById(id);\r\n\r\n      if (modalElement) {\r\n        const modal = new mdb.Modal(modalElement);\r\n        modal.show();\r\n\r\n        modalElement.addEventListener('hidden.bs.modal', () => {\r\n          this.set('is-first-visit', false);\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  static showModalScoring(id, value) {\r\n    const counter = Number(this.get('visit-counter')) || 0;\r\n    const newCounter = counter + 1;\r\n\r\n    this.set('visit-counter', newCounter);\r\n\r\n    if (newCounter === value) {\r\n      const modalElement = document.getElementById(id);\r\n\r\n      if (modalElement) {\r\n        const modal = new mdb.Modal(modalElement);\r\n        modal.show();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default Storage;\r\n"],"names":["NAME","set","name","value","expires","this","checkExpiry","localStorage","setItem","JSON","stringify","expiryList","get","Date","Number","isPresentOnExpiryList","index","findIndex","el","push","parse","getItem","remove","removeItem","filteredList","filter","Object","keys","some","check","time","callback","intervalId","setInterval","clearInterval","now","elKey","showModalNewUser","id","modalElement","document","getElementById","mdb","Modal","show","addEventListener","showModalScoring","newCounter"],"mappings":"+OAEA,MAEE,eAAWA,GACF,MALE,SAMV,CAOD,UAAOC,CAAIC,EAAMC,EAAOC,GAMlB,GAJJC,KAAKC,cAELC,aAAaC,QAAQN,EAAMO,KAAKC,UAAUP,IAEnB,iBAAZC,EAAsB,CAC/B,MAAMO,EAAaN,KAAKO,IAAI,eAAiB,GAKzC,GAFMR,EAAA,IAAIS,KAAKC,OAAW,IAAAD,MAAoB,IAAVT,EAAiB,GAAK,GAAK,IAE/DC,KAAKU,sBAAsBb,GAAO,CAC9B,MAAAc,EAAQL,EAAWM,WAAWC,QAAoB,IAAbA,EAAGhB,KACnCS,EAAAK,GAAOd,GAAQE,CAClC,MACQO,EAAWQ,KAAK,CAAEjB,CAACA,GAAOE,IAG5BG,aAAaC,QAAQ,aAAcC,KAAKC,UAAUC,GACnD,CAED,MAAO,GAAGT,MAASC,gBAAoBC,GACxC,CAED,UAAOQ,CAAIV,GAIT,OAFAG,KAAKC,cAEEG,KAAKW,MAAMb,aAAac,QAAQnB,GACxC,CAED,aAAOoB,CAAOpB,GAEZG,KAAKC,cAELC,aAAagB,WAAWrB,GAExB,MAAMS,EAAaN,KAAKO,IAAI,eAAiB,GAEzC,GAAAP,KAAKU,sBAAsBb,GAAO,CACpC,MAAMsB,EAAeb,EAAWc,QAAQP,GACxBQ,OAAOC,KAAKT,GACb,KAAOhB,IAGtBK,aAAaC,QAAQ,aAAcC,KAAKC,UAAUc,GACnD,CACF,CAED,4BAAOT,CAAsBb,GAEpB,OADYG,KAAKO,IAAI,eAAiB,IAC3BgB,MAAMV,QACF,IAAbA,EAAGhB,IAEb,CAED,YAAO2B,CAAM3B,EAAM4B,EAAMC,GACvB,MAEMP,GAFanB,KAAKO,IAAI,eAAiB,IAEba,QAAQP,GACxBQ,OAAOC,KAAKT,GACb,KAAOhB,IAMhB8B,EAAaC,aAAY,KACzB,IAAIpB,KAAKW,EAAa,GAAGtB,IAAa,IAAAW,WAExCqB,cAAcF,IAGhB3B,KAAKC,aAAW,GARVwB,GAAA,IAUT,CAED,kBAAOxB,GACC,MAAAK,EAAaF,KAAKW,MAAMb,aAAac,QAAQ,gBAAkB,GAC/Dc,MAAUtB,KAELF,EAAAc,QAAQP,IACX,MAAAkB,EAAQV,OAAOC,KAAKT,GAMnB,OAJHiB,EAAM,IAAItB,KAAKK,EAAGkB,KACP7B,aAAAgB,WAAWa,EAAM,IAGzBlB,EAAGkB,IAAUD,CAAA,GAEvB,CAED,uBAAOE,CAAiBC,GACtB,GAAmC,OAA/BjC,KAAKO,IAAI,kBAA4B,CACjC,MAAA2B,EAAeC,SAASC,eAAeH,GAE7C,GAAIC,EAAc,CACF,IAAIG,IAAIC,MAAMJ,GACtBK,OAEOL,EAAAM,iBAAiB,mBAAmB,KAC1CxC,KAAAJ,IAAI,kBAAkB,EAAK,GAEnC,CACF,CACF,CAED,uBAAO6C,CAAiBR,EAAInC,GAC1B,MACM4C,GADUjC,OAAOT,KAAKO,IAAI,mBAAqB,GACxB,EAI7B,GAFKP,KAAAJ,IAAI,gBAAiB8C,GAEtBA,IAAe5C,EAAO,CAClB,MAAAoC,EAAeC,SAASC,eAAeH,GAE7C,GAAIC,EAAc,CACF,IAAIG,IAAIC,MAAMJ,GACtBK,MACP,CACF,CACF"}